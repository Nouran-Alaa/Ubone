<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Detail</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    crossorigin="anonymous" />
  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/nav&Footer.css">
  <style>
    .navbar {
      background-color: #f5f5f623;
    }

    .line-through {
      text-decoration: line-through;
    }

    .star-rating {
      color: #ffd700;
    }

    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 0.375rem;
      transition: background-color 0.3s;
    }

    .btn i {
      margin-right: 0.5rem;
    }

    .btn-cart {
      background-color: #3b82f6;
      color: white;
    }

    .btn-cart:hover {
      background-color: #2563eb;
    }

    .btn-buy {
      background-color: #f3f4f6;
      color: #1f2937;
    }

    .btn-buy:hover {
      background-color: #e5e7eb;
    }
  </style>
</head>

<body class="bg-gray-100">
  <!-- navbar -->
  <nav class="navbar navbar-expand-lg py-2">
    <div class="container-fluid">
      <a class="navbar-brand d-flex" href="../index.html">
        <img src="../images/logo-9.png" alt="logo">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="../index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="products.html">Products</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-icon" href="cart.html">
              <i class="fa-solid fa-cart-shopping"></i>
              <span class="cart-counter small-icon-count">0</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-icon" href="wishlist.html">
              <i class="fa-solid fa-heart"></i>
              <span class="wishlist-counter small-icon-count">0</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Product Detail -->
  <div class="container mx-auto mt-10">
    <div class="bg-white p-10 rounded-lg shadow-lg flex">
      <div id="product-images" class="w-1/2">
        <img id="main-image" src="" alt="" class="w-full rounded-lg mb-4" />
        <div class="flex">
          <!-- Thumbnails will be injected here -->
        </div>
      </div>
      <div class="w-1/2 pl-10">
        <h1 id="product-title" class="text-2xl font-bold"></h1>
        <div class="flex items-center mt-2">
          <div id="product-rating" class="star-rating text-lg flex"></div>
          <p id="review-count" class="text-gray-600 ml-2"></p>
        </div>
        <div class="flex items-center mt-2">
          <span id="old-price" class="text-gray-500 line-through mr-2"></span>
          <span id="new-price" class="text-xl text-green-500 font-semibold"></span>
        </div>
        <div id="sale-timer" class="text-red-500 mt-2"></div>
        <p id="product-availability" class="text-gray-600 mt-2"></p>
        <p id="product-description" class="text-gray-700 mt-4"></p>
        <div class="product-meta mt-4">
          <p class="mt-2">
            <strong>SKU:</strong> <span id="product-sku"></span>
          </p>
          <p class="mt-2">
            <strong>Brand:</strong> <span id="product-brand"></span>
          </p>
        </div>
        <div class="product-additional mt-4">
          <p class="mt-2">
            <strong>Weight:</strong> <span id="product-weight"></span>g
          </p>
          <p class="mt-2">
            <strong>Dimensions:</strong> <span id="product-dimensions"></span>
          </p>
          <p class="mt-2">
            <strong>Warranty:</strong> <span id="product-warranty"></span>
          </p>
          <p class="mt-2">
            <strong>Shipping:</strong> <span id="product-shipping"></span>
          </p>
        </div>
        <div id="product-reviews" class="mt-6">
          <h2 class="text-lg font-bold">Reviews</h2>
          <!-- Reviews will be injected here -->
        </div>
        <div class="flex mt-6">
          <button class="btn btn-cart mr-4" onclick="addToCart()">
            <i class="fas fa-shopping-cart"></i> Add to Cart
          </button>
          <button class="btn btn-buy" onclick="addToWishlist()">
            <i class="fas fa-heart"></i> Add to Wishlist
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const storedWishlistCounter = sessionStorage.getItem("wishlistCounter");
      const storedCartCounter = sessionStorage.getItem("cartCounter");
      const wishlistCounterElement = document.querySelector(".wishlist-counter");


      if (storedWishlistCounter !== null) {
        wishlistCounterElement.textContent = storedWishlistCounter;
      }

      if (storedCartCounter !== null) {
        cartCounterElement.textContent = storedCartCounter;
      }
    });
    document.addEventListener("DOMContentLoaded", function () {
      // get product ID from URL
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get("id");
      const wishlistCounterElement = document.querySelector(".wishlist-counter");


      // fetch product details
      if (productId) {
        fetch(`https://dummyjson.com/products/${productId}`)
          .then((response) => response.json())
          .then((product) => {
            // set main product image
            const mainImage = document.getElementById("main-image");
            mainImage.src = product.images[0];
            mainImage.alt = product.title;

            // set product thumbnails
            const productImages = document.getElementById("product-images");
            product.images.forEach((image, index) => {
              if (index === 0) return; // Skip the main image
              const imgElement = document.createElement("img");
              imgElement.src = image;
              imgElement.alt = product.title;
              imgElement.classList.add(
                "w-20",
                "h-20",
                "rounded-lg",
                "mr-2",
                "cursor-pointer"
              );
              imgElement.addEventListener("click", () => {
                mainImage.src = image;
              });
              productImages.querySelector(".flex").appendChild(imgElement);
            });

            // set product details
            document.getElementById("product-title").innerText = product.title;
            document.getElementById("new-price").innerText = `$${product.price}`;
            document.getElementById("old-price").innerText = `$${(
              product.price /
              (1 - product.discountPercentage / 100)
            ).toFixed(2)}`;
            document.getElementById("sale-timer").innerText = "Sale ends in: 574:07:40:04";
            document.getElementById("product-availability").innerText = `Availability: ${product.availabilityStatus} (${product.stock} in stock)`;
            document.getElementById("product-description").innerText = product.description;
            document.getElementById("product-sku").innerText = product.sku;
            document.getElementById("product-brand").innerText = product.brand;
            document.getElementById("product-weight").innerText = product.weight;
            document.getElementById("product-dimensions").innerText = `${product.dimensions.width}x${product.dimensions.height}x${product.dimensions.depth}`;
            document.getElementById("product-warranty").innerText = product.warrantyInformation;
            document.getElementById("product-shipping").innerText = product.shippingInformation;

            // set product rating
            const productRating = document.getElementById("product-rating");
            const fullStars = Math.floor(product.rating);
            const halfStar = product.rating % 1 !== 0;
            for (let i = 0; i < fullStars; i++) {
              productRating.innerHTML += '<i class="fas fa-star"></i>';
            }
            if (halfStar) {
              productRating.innerHTML += '<i class="fas fa-star-half-alt"></i>';
            }
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
            for (let i = 0; i < emptyStars; i++) {
              productRating.innerHTML += '<i class="far fa-star"></i>';
            }

            // set review count
            const reviewCount = product.reviews.length;
            document.getElementById("review-count").innerText = `${reviewCount} review${reviewCount !== 1 ? "s" : ""}`;

            // set product reviews container
            const reviewsContainer = document.getElementById("product-reviews");
            product.reviews.forEach((review) => {
              const reviewElement = document.createElement("div");
              reviewElement.classList.add("bg-gray-100", "p-4", "mt-4", "rounded-lg");
              reviewElement.innerHTML = `
                                <p><strong>${review.reviewerName}</strong> (${new Date(review.date).toLocaleDateString()}): ${review.comment} - ${review.rating} stars</p>
                            `;
              reviewsContainer.appendChild(reviewElement);
            });

            window.currentProduct = product;
          })
          .catch((error) => console.error("Error fetching product:", error));
      } else {
        console.error("No product ID found in URL");
      }
    });

    // add to cart function will get the product object and add it to the cart in the local storage
    function addToCart() {
      if (!window.currentProduct) {
        console.error("Product details not loaded yet");
        return;
      }
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get("id");

      const productAddToCart = {
        ...window.currentProduct,
        quantity: 1,
      };

      if (productAddToCart) {
        const existingItem = userCart.find(
          (item) => item.id === parseInt(productId)
        );

        if (existingItem) {
          // If the item exists in the cart, increment its quantity
          existingItem.quantity = (existingItem.quantity || 0) + 1;
        } else {
          // If the item doesn't exist in the cart, add it with a quantity of 1
          productAddToCart.quantity = 1;
          userCart.push(productAddToCart);
        }
      }


      // Update the cart counter and save to sessionStorage
      cartCounterElement.textContent = userCart.reduce(
        (acc, curr) => acc + curr.quantity,
        0
      );
      sessionStorage.setItem("cartCounter", cartCounterElement.textContent);
      sessionStorage.setItem("userCart", JSON.stringify(userCart));
    }

    // add to wishlist function will get the product object and add it to the wishlist in the local storage
    function addToWishlist() {
      event.stopPropagation();

      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get("id");

      fetch(`https://dummyjson.com/products/${productId}`)
        .then((response) => response.json())
        .then((data) => {
          let productAddToWishlist = data;

          console.log("productAddToWishlist", productAddToWishlist);

          let userCart = JSON.parse(sessionStorage.getItem("userCart")) || [];
          let userWishList = JSON.parse(sessionStorage.getItem("userWishList")) || [];

          if (productAddToWishlist) {
            const existingItem = userWishList.find(
              (item) => item.id === parseInt(productId)
            );

            if (existingItem) {
              // If the item exists in the wishlist, increment its quantity
              existingItem.wishlist = (existingItem.wishlist || 0) + 1;
            } else {
              // If the item doesn't exist in the wishlist, add it with a quantity of 1
              productAddToWishlist.wishlist = 1;
              userWishList.push(productAddToWishlist);
            }
          }

          const wishlistCounterElement = document.querySelector(".wishlist-counter");

          // Update the wishlist counter and save to sessionStorage
          wishlistCounterElement.textContent = userWishList.reduce(
            (acc, curr) => acc + curr.wishlist,
            0
          );
          console.log("wishlistCounterElement", wishlistCounterElement.textContent);
          sessionStorage.setItem(
            "wishlistCounter",
            wishlistCounterElement.textContent
          );
          sessionStorage.setItem("userWishList", JSON.stringify(userWishList));
        })
    }

    function updateCartCounter() {
      const userCart = JSON.parse(sessionStorage.getItem("userCart")) || [];
      const cartCounterElement = document.querySelector(".cart-counter");
      if (cartCounterElement) {
        cartCounterElement.textContent = userCart.reduce((acc, curr) => acc + (curr.quantity || 0), 0);
      }
    }

    function updateWishlistCounter() {
      let userWishList = JSON.parse(sessionStorage.getItem("userWishList")) || [];
      const wishlistCounterElement = document.querySelector(".wishlist-counter");
      if (wishlistCounterElement) {
        wishlistCounterElement.textContent = userWishList.reduce(
          (acc, curr) => acc + curr.wishlist,
          0
        );
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      updateCartCounter();
      updateWishlistCounter();
    });
  </script>
  <!-- Bootstrap JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
  <!-- Navbar -->
  <script src="../js/navbar.js"></script>
</body>

</html>
