<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Validation</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    <style>
      .error {
        color: red;
      }
    </style>
  </head>
  <body>
    <div class="info d-flex flex-column gap-3 py-2" id="myForm">
      <!-- Your form HTML here (same as provided) -->

      <div class="complete border-bottom">
        <button class="btn btn-primary btn-comp w-100" id="submitBtn">
          <span>Complete Order</span>
        </button>
      </div>

      <p>All rights reserved Ubone (password: 1)</p>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("myForm");
        const submitButton = document.querySelector(".btn-comp");

        const validateEmail = (email) => {
          const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return re.test(email);
        };

        const validatePhoneNumber = (phone) => {
          const re = /^\d{10}$/; // Adjust this pattern according to your requirements
          return re.test(phone);
        };

        const showError = (radioGroupName, message) => {
          const radioGroup = document.querySelector(
            `.radio-group-container[data-group="${radioGroupName}"]`
          );
          const errorMessageDiv = radioGroup.querySelector(".error-message");

          if (!errorMessageDiv) {
            // Create error message container if it doesn't exist
            const newErrorDiv = document.createElement("div");
            newErrorDiv.classList.add("error-message");
            radioGroup.appendChild(newErrorDiv);
            errorMessageDiv = newErrorDiv;
          }

          // Show error if no radio button is selected
          errorMessageDiv.innerText = message;
          errorMessageDiv.style.display = "block";
          radioGroup.classList.add("error");
        };

        const removeError = (radioGroupName) => {
          const radioGroup = document.querySelector(
            `.radio-group-container[data-group="${radioGroupName}"]`
          );
          const errorMessageDiv = radioGroup.querySelector(".error-message");

          if (errorMessageDiv) {
            errorMessageDiv.style.display = "none";
          }

          radioGroup.classList.remove("error");
        };

        const validateField = (input) => {
          if (input.type === "email") {
            if (!validateEmail(input.value)) {
              showError("email", "Please enter a valid email address.");
            } else {
              removeError("email");
            }
          } else if (input.id === "phone") {
            if (!validatePhoneNumber(input.value)) {
              showError("phone", "Please enter a valid phone number.");
            } else {
              removeError("phone");
            }
          } else if (input.type === "radio") {
            if (input.name === "paymentMethod" || input.name === "address") {
              const checkedRadio = document.querySelector(
                `input[name="${input.name}"]:checked`
              );
              if (!checkedRadio) {
                showError(input.name, "Please select an option.");
              } else {
                removeError(input.name);
              }
            }
          } else {
            if (input.value.trim() === "") {
              showError("generic", "This field is required.");
            } else {
              removeError("generic");
            }
          }
        };

        form.addEventListener("input", function (event) {
          const input = event.target;
          if (
            input.tagName.toLowerCase() === "input" ||
            input.tagName.toLowerCase() === "checkbox"
          ) {
            validateField(input);
          }
        });

        submitButton.addEventListener("click", function (event) {
          event.preventDefault();
          let isValid = true;

          const fields = [
            "email",
            "country",
            "firstname",
            "lastname",
            "address",
            "city",
            "state",
            "zipcode",
            "phone",
          ];

          fields.forEach(function (field) {
            const input = document.getElementById(field);
            if (input) {
              validateField(input);
              if (input.classList.contains("error")) {
                isValid = false;
              }
            }
          });

          // Check radio buttons
          const radioGroups = ["paymentMethod", "address"];
          radioGroups.forEach((name) => {
            const checkedRadio = document.querySelector(
              `input[name="${name}"]:checked`
            );
            if (!checkedRadio) {
              showError(name, "Please select an option.");
              isValid = false;
            } else {
              removeError(name);
            }
          });

          if (isValid) {
            alert(
              "Thank you for your order! Your order has been successfully placed."
            );
            sessionStorage.setItem("scrollToTop", "true");
            location.reload(true);
          }
        });
      });

      //////////////////// CART JS ///////////////////////

      document.addEventListener("DOMContentLoaded", () => {
        const cartContainer = document.getElementById("cart-container");

        // Get the cart from session storage
        let cart = JSON.parse(sessionStorage.getItem("cart")) || [];

        // If the cart is empty, display a message
        if (cart.length === 0) {
          cartContainer.innerHTML = "<p>Your cart is empty.</p>";
          return;
        }

        // Generate HTML for each item in the cart
        cart.forEach((item) => {
          const itemDiv = document.createElement("div");
          itemDiv.classList.add("cart-item");

          itemDiv.innerHTML = `
          <img src="${item.imageUrl}" alt="${item.title}" width="100" height="130">
          <div>
              <h3>${item.title}</h3>
              <p>Price: ${item.price}</p>
              <p>Size: ${item.size}</p>
              <p>Color: ${item.color}</p>
          </div>
      `;

          cartContainer.appendChild(itemDiv);
        });
      });

      /////////////////////////////////////////////////

      function decrement(e) {
        const btn = e.target.parentNode.parentElement.querySelector(
          'button[data-action="decrement"]'
        );
        const target = btn.nextElementSibling;
        let value = Number(target.value);
        value--;
        target.value = value;
      }

      function increment(e) {
        const btn = e.target.parentNode.parentElement.querySelector(
          'button[data-action="decrement"]'
        );
        const target = btn.nextElementSibling;
        let value = Number(target.value);
        value++;
        target.value = value;
      }

      const decrementButtons = document.querySelectorAll(
        `button[data-action="decrement"]`
      );

      const incrementButtons = document.querySelectorAll(
        `button[data-action="increment"]`
      );

      decrementButtons.forEach((btn) => {
        btn.addEventListener("click", decrement);
      });

      incrementButtons.forEach((btn) => {
        btn.addEventListener("click", increment);
      });

      //////////////////////////////////
    </script>
  </body>
</html>
